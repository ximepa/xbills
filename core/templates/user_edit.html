{% extends 'layout_edit.html' %}
{% load i18n %}
{% load staticfiles %}
{% load url %}
{% block extra_js %}
{% endblock %}
{% block extra_css %}
{% endblock %}
{% block extra_scripts %}
<script type="application/javascript">
    $(function () {
        $("#olltv").popover({
            html : true,
            placement: 'bottom',
            container: 'body',
            trigger: 'focus',
            content: function() {
              return $("#olltv-content").html();
            },
            title: function() {
              return $("#olltv-title").html();
            }
        });
    });
</script>
{% endblock %}
{% block breadcrumbs %}
    <ol class="breadcrumb">
      <li class=""><a href="{% url 'core:index' %}"><i class="fa fa-dashboard fa-fw"></i>{% trans 'Dashboard' %}</a></li>
      <li class="active"><i class="fa fa-user fa-fw"></i>{{ client.login }} (UID: {{ client.id }})</li>
    </ol>
{% endblock %}
{% block content %}
    <div class="row" id="pop">
        <div class="column">
                <div class="header">
                    <span class="label label-default"><i class="fa fa-cog"></i> {% trans 'User bill' %}</span>
                </div>
                <br/>
                <form class="form-horizontal" method="post" name="bills_form">{% csrf_token %}
                    <div class="row">
                        <div class="column">
                            <div class="form-group form-group-sm">
                                <label for="inputEmail3" class="col-sm-4 control-label">{% trans 'Deposit:' %}</label>
                                <div class="col-sm-8">
                                    {% if client.credit > client.bill.deposit and client.credit > 0 %}
                                        <span class="label label-default form-control-static" >{{ client.bill.deposit|floatformat:4 }}</span>
                                    {% elif client.bill.deposit > 50 %}
                                        <span class="label label-success form-control-static" >{{ client.bill.deposit|floatformat:4 }}</span>
                                    {% elif client.bill.deposit < 50 and client.bill.deposit > 20 %}
                                        <span class="label label-primary form-control-static" >{{ client.bill.deposit|floatformat:4 }}</span>
                                    {% elif client.bill.deposit < 20 and client.bill.deposit > 2.50 %}
                                        <span class="label label-warning form-control-static" >{{ client.bill.deposit|floatformat:4 }}</span>
                                    {% else %}
                                        <span class="label label-danger form-control-static" >{{ client.bill.deposit|floatformat:4 }}</span>
                                    {% endif %}
                                    <div class="pull-right">
                                        <a id="pay" href="{% url 'core:client_payments' uid %}"><i class="fa fa-plus-circle"></i></a>
                                        <a href="{% url 'core:client_fees' uid %}"><i class="fa fa-minus-circle"></i></a>
                                        <a><i class="fa fa-print"></i></a>
                                        {% if olltv_exist %}
                                            <a href="#" id="olltv"><i class="fa fa-television" aria-hidden="true"></i></a>
                                            <div id="olltv-content" class="hidden">
                                                <div>
                                                    <div class="row">
                                                        {% if user_olltv.disable == 1 or user_olltv.disable == 2 %}
                                                            <div class="col-md-12">
                                                                <div class="form-group form-group-sm center-block">
                                                                    <label class="col-sm-2 control-label">{% trans 'Iptv status' %}:</label>
                                                                    <div class="col-sm-10">
                                                                        {{ iptv.mac }}
                                                                        <span class="label label-danger">{% trans 'Disabled' %}</span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        {% else %}
                                                            <div class="col-md-6">
                                                                <div class="form-group form-group-sm">
                                                                    <label for="olltv_device" class="col-sm-2 control-label">{% trans 'Iptv device' %}:</label>
                                                                    <div class="col-sm-10">
                                                                        <ul class="list-group text-center">
                                                                            {% for dev in user_olltv_dev %}
                                                                                {% if dev.status == 1 %}
                                                                                    <li class="list-group-item disabled" data-toggle="tooltip" data-placement="top" title="{{ dev.date_added }} - {{ dev.status }}">{{ dev.id }} - {% trans 'MAC' %}: {{ dev.mac }} | {% trans 'Serial' %}: {{ dev.serial_num }}</li>
                                                                                {% else %}
                                                                                    <li class="list-group-item" data-toggle="tooltip" data-placement="top" title="{{ dev.date_added }} - {{ dev.status }}">{{ dev.id }} - {% trans 'MAC' %}: {{ dev.mac }} | {% trans 'Serial' %}: {{ dev.serial_num }}</li>
                                                                                {% endif %}
                                                                            {% endfor %}
                                                                        </ul>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            {% if tp_list %}
                                                                <div class="col-md-6">
                                                                    <div class="form-group form-group-sm">
                                                                        <label for="expire-date" class="col-sm-2 control-label">{% trans 'Iptv tarif' %}:</label>
                                                                        <div class="col-sm-10">
                                                                            <ul class="list-group text-center">
                                                                                {% for tp in tp_list %}
                                                                                    <li class="list-group-item" data-toggle="tooltip" data-placement="top" title="{{ tp.start_date }} - {{ tp.expiration_date }}">{% trans 'Name' %}: {{ tp.name }} | {% trans 'Binding code' %}: {{ tp.device_binding_code }}</li>
                                                                                {% endfor %}
                                                                            </ul>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            {% endif %}
                                                        {% endif %}
                                                    </div>

                                                </div>
                                            </div>
                                            <div id="olltv-title" class="hidden">
                                                <b>{% trans 'Olltv' %}</b>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group form-group-sm">
                                <label for="inputPassword3" class="col-sm-4 control-label">{% trans 'Credit' %}</label>
                                <div class="col-sm-8">
                                    <input type="number" class="form-control" id="credit" name="credit" placeholder="{% trans 'Credit' %}" value="{{ client.credit }}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group form-group-sm">
                                <label for="inputPassword3" class="col-sm-4 control-label">{% trans 'Company:' %}</label>
                                <div class="col-sm-8">
                                    <div class="input-group">
                                        <input type="text" class="form-control" placeholder="{% trans 'Company' %}" aria-describedby="group" disabled value="{{ client.company }}">
                                        <span class="input-group-addon" id="group">
                                            <a href="{% url 'core:user_company' uid %}">
                                                {% if client.company != 0 %}
                                                    <i class="fa fa-edit fa-fw"></i>
                                                {% else %}
                                                    <i class="fa fa-plus fa-fw"></i>
                                                {% endif %}
                                            </a>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group form-group-sm">
                                <label for="inputPassword3" class="col-sm-4 control-label">{% trans 'Credit date' %}</label>
                                <div class="col-sm-8">
                                    <div id="credit_date-datepicker" class="">
                                        <div class="input-group">
                                            <input type="date" class="form-control" id="credit_date" placeholder="{% trans 'Credit date' %}" value="{{ client.credit_date|default:"0000-00-00" }}">
                                            <span class="input-group-addon add-on" id="credit-date">
                                                <i class="fa fa-calendar" data-time-icon="icon-time" data-date-icon="fa-calendar"></i>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group form-group-sm">
                                <label for="inputEmail3" class="col-sm-4 control-label">{% trans 'Group' %}</label>
                                <div class="col-sm-8">
                                    <div class="input-group">
                                        <input href="#" data-type="text" type="text" class="form-control" placeholder="{% trans 'Group' %}" aria-describedby="group" value="{{ client.gid }}">
                                        <a href="#" id="projectname{{project.id}}" data-type="text" data-pk="{{project.id}}" data-title="Enter project name" data-url="{% url 'core:user_group' client.id %}" data-params="{csrfmiddlewaretoken:'{{csrf_token}}'}">{{ project.name }}</a>
                                      <span class="input-group-addon" id="group">
                                          <a href="#" id="status" data-type="select" data-pk="1" data-url="{% url 'core:user_group' client.id %}">
                                              <i class="fa fa-edit fa-fw"></i>
                                          </a>
                                      </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group form-group-sm">
                                <label for="inputEmail3" class="col-sm-4 control-label">{% trans 'Cash account' %}</label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" id="" placeholder="{% trans 'Cash account' %}" disabled value="{{ bill.id }}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group form-group-sm">
                                <label for="inputPassword3" class="col-sm-4 control-label">{% trans 'Reduction' %}</label>
                                <div class="col-sm-8">
                                    <div class="input-group">
                                        <input type="text" class="form-control" placeholder="{% trans 'Reduction' %}" aria-describedby="group" value="{{ client.reduction }}">
                                        <span class="input-group-addon" id="reduction"><i class="fa fa-percent fa-fw"></i></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group form-group-sm">
                                <label for="reduction-date" class="col-sm-4 control-label">{% trans 'Reduction date' %}</label>
                                <div class="col-sm-8">
                                    <div id="reduction_date-datepicker" class="">
                                        <div class="input-group">
                                            <input data-format="yyyy-MM-dd" type="date" class="form-control" id="reduction_date" aria-describedby="reduction-date" name="reduction_date" placeholder="{% trans 'Reduction date' %}" value="{{ client.reduction_date|default:"0000-00-00" }}">
                                            <span class="input-group-addon add-on" id="reduction-date">
                                                <i class="fa fa-calendar" data-time-icon="icon-time" data-date-icon="fa-calendar"></i>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group form-group-sm">
                                <label for="disable" class="col-sm-4 control-label">{% trans 'Disable' %}</label>
                                <div class="col-sm-1">
                                    {% if client.disabled == True %}
                                        <input id="disable" type="checkbox" name="disable" value="1" checked onclick="changeValueCheckbox(this)">
                                    {% else %}
                                        <input id="disable" type="checkbox" name="disable" onclick="changeValueCheckbox(this)">
                                    {% endif %}
                                    <input type="text" class="form-control hidden" id="reason" name="reason">
                                    <script type="application/javascript">
                                        function changeValueCheckbox(element){
                                            if(element.checked){
                                                element.value='1';
                                            }else{
                                                element.value='0';
                                            }
                                            if (element.value == 1){
                                                var reason = prompt('{% trans 'Reason' %}');
                                                if (reason != null){
                                                    $('#reason').removeClass('hidden');
                                                    $('#reason').val(reason);
                                                } else {
                                                    element.value = '0';
                                                    $(element).removeAttr('checked')
                                                }
                                            } else {
                                                $('#reason').addClass('hidden');
                                                element.value = '0';
                                            }
                                        }
                                    </script>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group form-group-sm">
                                <label for="activation-date" class="col-sm-4 control-label">{% trans 'Activation' %}</label>
                                <div class="col-sm-8">
                                    <div id="activation-datepicker" class="">
                                        <div class="input-group">
                                            <input data-format="yyyy-MM-dd" type="date" class="form-control" id="activation" aria-describedby="activation-date" name="activation" placeholder="{% trans 'Activation' %}" value="{{ client.activate|default:"0000-00-00" }}">
                                            <span class="input-group-addon add-on" id="activation-date">
                                                <i class="fa fa-calendar" data-time-icon="icon-time" data-date-icon="fa-calendar"></i>
                                            </span>
                                        </div>
                                    </div>
                         <div id="user-bill" class="well well-sm">
                   </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group form-group-sm">
                                <label for="registration" class="col-sm-4 control-label">{% trans 'Registration' %}</label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" id="registration" name="registration" placeholder="" disabled value="{{ client.pi.contract_date }}">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group form-group-sm">
                                <label for="expire-date" class="col-sm-4 control-label">{% trans 'Expire' %}</label>
                                <div class="col-sm-8">
                                    <div class="input-group">
                                        <input data-format="yyyy-MM-dd" type="date" class="form-control" id="expire" name="expire" placeholder="{% trans 'Expire' %}" value="{{ client.expire|default:"0000-00-00" }}">
                                        <span class="input-group-addon add-on" id="expire-date">
                                            <i class="fa fa-calendar" data-time-icon="icon-time" data-date-icon="fa-calendar"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <hr/>
                            <div class="text-center">
                                {% if user_password %}
                                    <span class="label label-success">{{ user_password }}</span>
                                {% else %}
                                    <a class="btn btn-default btn-xs" href="{% url 'core:client' uid %}?show_password=1" role="button">{% trans 'Show password' %}</a>
                                {% endif %}
                                <button type="button" class="btn btn-default btn-xs">{% trans 'Change password' %}</button>
                                <button type="button" class="btn btn-default btn-xs">{% trans 'Send password SMS' %}</button>
                            </div>
                        </div>
                    </div>
                    <hr/>
                    <input type="submit" class="btn btn-primary btn-xs center-block" value="{% trans 'Change' %}">
                </form>
        </div>
    </div>
{% endblock %}
{% block extra_content %}
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12">
            <div class="well well-sm text-center">
                <ul class="list-inline">
                    <li><a class="btn btn-primary btn-xs" title="{% trans 'Statistics' %}" href="{% url 'core:client_statistics' uid %}">{% trans 'Statistics' %}</a></li>
                    <li><a class="btn btn-danger btn-xs" title="{% trans 'Errors' %}" href="{% url 'core:client_errors' uid %}">{% trans 'Errors' %}</a></li>
                    <li><a class="btn btn-primary btn-xs" title="Расписание" href="">Расписание</a></li>
                    <li><a class="btn btn-primary btn-xs" title="Компенсация" href="">Компенсация</a></li>
                </ul>
            </div>
        </div>
    </div>
    {% check_module 'claims' as check_module_claims %}
        {% if check_module_claims and claims %}
            <div class="row">
                <div class="col-xs-12 col-sm-12 col-md-12">
                    <div class="well well-sm text-center">
                        <table class="ui black table">
                            <th>
                                {% trans 'Problem' %}
                            </th>
                            <th>
                                {% trans 'Theme|Address' %}
                            </th>
                            <th>
                                {% trans 'State' %}
                            </th>
                            <th>
                                {% trans 'Queue' %}
                            </th>
                            <th>
                                {% trans 'Worker' %}
                            </th>
                            <th>
                                {% trans 'Age' %}
                            </th>
                        <tbody>
                            {% for c in claims %}
                                {% if c.priority_id == 3 %}
                                    <tr class="danger">
                                {% elif c.priority_id == 2 %}
                                    <tr class="warning">
                                {% else %}
                                    <tr>
                                {% endif %}
{#                                    <td><a href="{% url 'claims:claim_edit' c.id%}" title="{% trans 'Edit' %}">{{ c.problem }}</a></td>#}

                                    <td>{{ c.address }}</td>

                                    <td>{{ c.state }}</td>

                                    <td>{{ c.owner }}</td>

                                    <td>{{ c.worker }}</td>
                                    <td>{{ c.created }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>

                        </table>
                    </div>
                </div>
            </div>
        {% endif %}
    {% if dv_session %}
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12">
                <div class="well well-sm text-center">
                    <div class="row">
                        <div class="col-xs-2 ol-sm-2 col-md-2"></div>
                        <div class="col-xs-8 ol-sm-8 col-md-8 text-center">
                            <table class="table table-striped table-hover table-condensed table-bordered">
                                <thead class="">
                                    <tr>
                                        <th class="text-center">IP</th>
                                        <th class="text-center">Session time</th>
                                        <th class="text-center">Trafic in</th>
                                        <th class="text-center">Trafic out</th>
                                        <th class="text-center">Server</th>
                                        <th class="text-center">Zap</th>
                                        <th class="text-center">Hangup</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for s in dv_session %}
                                        <tr>
                                            <td>
                                                {% ip_convert s.framed_ip_address %}
                                            </td>
                                            <td>
                                                {% convert_timestamp_to_time s.started %}
                                            </td>
                                            <td>
                                                {% convert_bytes s.acct_input_octets s.acct_input_gigawords%}
                                            </td>
                                            <td>
                                                {% convert_bytes s.acct_output_octets s.acct_output_gigawords%}
                                            </td>
                                            <td>
                                                {{ s.nas.name }}
                                            </td>
                                            <td>
                                                <a class="btn btn-xs btn-link" href="#">
                                                    <span class="fa fa-times fa-fw"></span>
                                                </a>
                                            </td>
                                            <td>
                                                <a class="btn btn-xs btn-link" href="?hangup&acct_session_id={{ s.acct_session_id }}&nas_id={{ s.nas_id }}&port_id={{ s.nas_port_id }}&user_name={{ s.user_name }}"><span class="fa fa-power-off fa-fw"></span></a>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <div class="col-md-2"></div>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12">
            <div class="well well-sm">
                {% include 'dv.html' with dv=dv %}
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12">
            <div class="well well-sm">
                <div class="page-header text-center">
                    <span class="label label-default"><i class="fa fa-cog"></i> {% trans 'User info' %}</span>
                </div>
                <br/>
                <form class="form-horizontal" method="post" name="user_form">{% csrf_token %}
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group form-group-sm">
                                <label for="inputEmail3" class="col-sm-4 control-label">{% trans 'FIO' %}</label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" id="firstname" name="firstname" placeholder="Firstname, Lastname" value="{{ client.pi.fio }}">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group form-group-sm">
                                <label for="DISTRICT" class="col-sm-4 control-label">{% trans 'Districts' %}</label>
                                <div class="col-sm-8">
                                    <select download-on-click='1' name='ADDRESS_DISTRICT' id='DISTRICT' class='form-control'>
                                        <option value="{{ client.pi.city_id }}">{{ client.pi.city }}</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group form-group-sm">
                                <label for="STREET" class="col-sm-4 control-label">{% trans 'Street' %}</label>
                                <div class="col-sm-8">
                                    <select download-on-click='1' name='ADDRESS_STREET' id='STREET' class='form-control'>
                                        <option value="{{ client.pi.street_id }}">{{ client.pi.street }}</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group form-group-sm">
                                <label for="inputEmail3" class="col-sm-4 control-label">E-mail</label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" id="e-mail" name="e-mail" placeholder="E-mail:" value="{{ client.pi.email }}">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group form-group-sm">
                                <label for="BUILD" class="col-sm-4 control-label">{% trans 'Build' %}:</label>
                                <div class="col-sm-8">
                                    <select download-on-click='1' name='ADDRESS_BUILD' id='BUILD' class='form-control'>
                                        <option value="{{ client.pi.location_id }}">{{ client.pi.location }}</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group form-group-sm">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group form-group-sm">
                                <label for="inputEmail3" class="col-sm-4 control-label">{% trans 'Phone' %} #1</label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" id="phone" name="phone" placeholder="{% trans 'phone' %}" value="{{ client.pi.phone }}">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group form-group-sm">
                                <label for="inputEmail3" class="col-sm-4 control-label">Flat</label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" id="flat" name="flat" placeholder="Flat:" value="{{ client.pi.kv }}">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group form-group-sm">
                                <label for="phone2" class="col-sm-4 control-label">{% trans 'Phone' %} #2</label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" id="phone2" name="phone2" placeholder="{% trans 'phone' %} #2" value="{{ client.pi.phone2 }}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr/>
                        <input type="submit" name="dv_submit" class="btn btn-primary btn-xs center-block" value="{% trans 'Change' %}">
                </form>
            </div>
        </div>
    </div>
{% endblock %}
