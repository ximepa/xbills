{% extends 'layout_edit.html' %}
{% load i18n %}
{% load staticfiles %}
{% load url %}
{% block extra_js %}
    <script src="{% static 'js/chosen.jquery.min.js' %}"></script>
{% endblock %}
{% block extra_css %}
    <link href="{% static 'css/chosen.min.css' %}" rel="stylesheet">
{% endblock %}
{% block extra_scripts %}
<script type="application/javascript">
    var SELF_URL = '{% url 'core:client' uid %}';
    var CHOSEN_PARAMS = {
        no_results_text: 'Не существует',
        allow_single_deselect: true,
        placeholder_text: '--'
    };

    $(function () {
        $('select:not(#type)').chosen(CHOSEN_PARAMS);
    });
</script>
{% endblock %}
{% block content %}
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12">
            <form class="form-horizontal" method="post" name="bills_form">{% csrf_token %}
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group form-group-sm">
                            <label for="inputEmail3" class="col-sm-4 control-label">{% trans 'Deposit:' %}</label>
                            <div class="col-sm-8">
                                {% if user.credit > user.bill.deposit and user.credit > 0 %}
                                    <span class="label label-default form-control-static" >{{ user.bill.deposit|floatformat:4 }}</span>
                                {% elif user.bill.deposit > 50 %}
                                    <span class="label label-success form-control-static" >{{ user.bill.deposit|floatformat:4 }}</span>
                                {% elif user.bill.deposit < 50 and user.bill.deposit > 20 %}
                                    <span class="label label-primary form-control-static" >{{ user.bill.deposit|floatformat:4 }}</span>
                                {% elif user.bill.deposit < 20 and user.bill.deposit > 2.50 %}
                                    <span class="label label-warning form-control-static" >{{ user.bill.deposit|floatformat:4 }}</span>
                                {% else %}
                                    <span class="label label-danger form-control-static" >{{ user.bill.deposit|floatformat:4 }}</span>
                                {% endif %}
                                <div class="pull-right">
                                    <a href="{% url 'core:client_payments' uid %}" class="btn btn-default btn-xs"><i class="fa fa-plus-circle"></i></a>
                                    <a href="{% url 'core:client_fees' uid %}" class="btn btn-default btn-xs"><i class="fa fa-minus-circle"></i></a>
                                    <a class="btn btn-default btn-xs"><i class="fa fa-print"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group form-group-sm">
                            <label for="inputPassword3" class="col-sm-4 control-label">{% trans 'Credit' %}</label>
                            <div class="col-sm-8">
                                <input type="number" class="form-control" id="credit" name="credit" placeholder="{% trans 'Credit' %}" value="{{ user.credit }}">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group form-group-sm">
                            <label for="inputPassword3" class="col-sm-4 control-label">{% trans 'Company:' %}</label>
                            <div class="col-sm-8">
                                <div class="input-group">
                                    <input type="text" class="form-control" placeholder="{% trans 'Company' %}" aria-describedby="group" disabled value="{{ user.company }}">
                                    <span class="input-group-addon" id="group">
                                        <a href="{% url 'core:user_company' uid %}">
                                            {% if user.company != 0 %}
                                                <i class="fa fa-edit fa-fw"></i>
                                            {% else %}
                                                <i class="fa fa-plus fa-fw"></i>
                                            {% endif %}
                                        </a>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group form-group-sm">
                            <label for="inputPassword3" class="col-sm-4 control-label">{% trans 'Credit date' %}</label>
                            <div class="col-sm-8">
                                <div id="credit_date-datepicker" class="">
                                    <div class="input-group">
                                        <input type="date" class="form-control" id="credit_date" placeholder="{% trans 'Credit date' %}" value="{{ user.credit_date|default:"0000-00-00" }}">
                                        <span class="input-group-addon add-on" id="credit-date">
                                            <i class="fa fa-calendar" data-time-icon="icon-time" data-date-icon="fa-calendar"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group form-group-sm">
                            <label for="inputEmail3" class="col-sm-4 control-label">{% trans 'Group' %}</label>
                            <div class="col-sm-8">
                                <div class="input-group">
                                  <input type="text" class="form-control" placeholder="{% trans 'Group' %}" aria-describedby="group" disabled value="{{ user.gid }}">
                                  <span class="input-group-addon" id="group">
                                      <a href="{% url 'core:user_group' user.id %}">
                                          <i class="fa fa-edit fa-fw"></i>
                                      </a>
                                  </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group form-group-sm">
                            <label for="inputEmail3" class="col-sm-4 control-label">{% trans 'Cash account' %}</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" id="" placeholder="{% trans 'Cash account' %}" disabled value="{{ bill.id }}">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group form-group-sm">
                            <label for="inputPassword3" class="col-sm-4 control-label">{% trans 'Reduction' %}</label>
                            <div class="col-sm-8">
                                <div class="input-group">
                                    <input type="text" class="form-control" placeholder="{% trans 'Reduction' %}" aria-describedby="group" value="{{ user.reduction }}">
                                    <span class="input-group-addon" id="reduction"><i class="fa fa-percent fa-fw"></i></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group form-group-sm">
                            <label for="reduction-date" class="col-sm-4 control-label">{% trans 'Reduction date' %}</label>
                            <div class="col-sm-8">
                                <div id="reduction_date-datepicker" class="">
                                    <div class="input-group">
                                        <input data-format="yyyy-MM-dd" type="date" class="form-control" id="reduction_date" aria-describedby="reduction-date" name="reduction_date" placeholder="{% trans 'Reduction date' %}" value="{{ user.reduction_date|default:"0000-00-00" }}">
                                        <span class="input-group-addon add-on" id="reduction-date">
                                            <i class="fa fa-calendar" data-time-icon="icon-time" data-date-icon="fa-calendar"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group form-group-sm">
                            <label for="inputPassword3" class="col-sm-4 control-label">{% trans 'Disable' %}</label>
                            <div class="col-sm-8">
                                {% if user.disabled == True %}
                                    <input id="disable" type="checkbox" name="disable" value="1" checked onclick="changeValueCheckbox(this)">
                                {% else %}
                                    <input id="disable" type="checkbox" name="disable" onclick="changeValueCheckbox(this)">
                                {% endif %}
                                <input type="text" class="form-control hidden" id="reason" name="reason">
                                <script type="application/javascript">
                                    function changeValueCheckbox(element){
                                        if(element.checked){
                                            element.value='1';
                                        }else{
                                            element.value='0';
                                        }
                                        if (element.value == 1){
                                            var reason = prompt('{% trans 'Reason' %}');
                                            if (reason != null){
                                                $('#reason').removeClass('hidden');
                                                $('#reason').val(reason);
                                            } else {
                                                element.value = '0';
                                                $(element).removeAttr('checked')
                                            }
                                        } else {
                                            $('#reason').addClass('hidden');
                                            element.value = '0';
                                        }
                                    }
                                </script>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group form-group-sm">
                            <label for="activation-date" class="col-sm-4 control-label">{% trans 'Activation' %}</label>
                            <div class="col-sm-8">
                                <div id="activation-datepicker" class="">
                                    <div class="input-group">
                                        <input data-format="yyyy-MM-dd" type="date" class="form-control" id="activation" aria-describedby="activation-date" name="activation" placeholder="{% trans 'Activation' %}" value="{{ user.activate|default:"0000-00-00" }}">
                                        <span class="input-group-addon add-on" id="activation-date">
                                            <i class="fa fa-calendar" data-time-icon="icon-time" data-date-icon="fa-calendar"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group form-group-sm">
                            <label for="registration" class="col-sm-4 control-label">{% trans 'Registration' %}</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" id="registration" name="registration" placeholder="" disabled value="{{ user.pi.contract_date }}">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group form-group-sm">
                            <label for="expire-date" class="col-sm-4 control-label">{% trans 'Expire' %}</label>
                            <div class="col-sm-8">
                                <div class="input-group">
                                    <input data-format="yyyy-MM-dd" type="date" class="form-control" id="expire" name="expire" placeholder="{% trans 'Expire' %}" value="{{ user.expire|default:"0000-00-00" }}">
                                    <span class="input-group-addon add-on" id="expire-date">
                                        <i class="fa fa-calendar" data-time-icon="icon-time" data-date-icon="fa-calendar"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% if olltv_exist %}
                    <div class="row">
                        {% if user_olltv.disable == 1 or user_olltv.disable == 2 %}
                            <div class="col-md-12">
                                <div class="form-group form-group-sm center-block">
                                    <label class="col-sm-6 control-label">{% trans 'Iptv status' %}:</label>
                                    <div class="col-sm-6">
                                        {{ iptv.mac }}
                                        <span class="label label-danger">{% trans 'Disabled' %}</span>
                                    </div>
                                </div>
                            </div>
                        {% else %}
                            <div class="col-md-6">
                                <div class="form-group form-group-sm">
                                    <label for="olltv_device" class="col-sm-4 control-label">{% trans 'Iptv device' %}:</label>
                                    <div class="col-sm-8">
                                        <ul class="list-group text-center">
                                            {% for dev in user_olltv_dev %}
                                                {% if dev.status == 1 %}
                                                    <li class="list-group-item disabled" data-toggle="tooltip" data-placement="top" title="{{ dev.date_added }} - {{ dev.status }}">{{ dev.id }} - {% trans 'MAC' %}: {{ dev.mac }} | {% trans 'Serial' %}: {{ dev.serial_num }}</li>
                                                {% else %}
                                                    <li class="list-group-item" data-toggle="tooltip" data-placement="top" title="{{ dev.date_added }} - {{ dev.status }}">{{ dev.id }} - {% trans 'MAC' %}: {{ dev.mac }} | {% trans 'Serial' %}: {{ dev.serial_num }}</li>
                                                {% endif %}
                                            {% endfor %}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            {% if tp_list %}
                                <div class="col-md-6">
                                    <div class="form-group form-group-sm">
                                        <label for="expire-date" class="col-sm-4 control-label">{% trans 'Iptv tarif' %}:</label>
                                        <div class="col-sm-8">
                                            <ul class="list-group text-center">
                                                {% for tp in tp_list %}
                                                    <li class="list-group-item" data-toggle="tooltip" data-placement="top" title="{{ tp.start_date }} - {{ tp.expiration_date }}">{% trans 'Name' %}: {{ tp.name }} | {% trans 'Binding code' %}: {{ tp.device_binding_code }}</li>
                                                {% endfor %}
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                        {% endif %}
                    </div>
                {% endif %}
                <div class="row">
                    <div class="col-md-12">
                        <div class="text-center">
                            {% if user_password %}
                                <span class="label label-success">{{ user_password }}</span>
                            {% else %}
                                <a class="btn btn-default btn-xs" href="{% url 'core:client' uid %}?show_password=1" role="button">{% trans 'Show password' %}</a>
                            {% endif %}
                            <button type="button" class="btn btn-default btn-xs">{% trans 'Change password' %}</button>
                            <button type="button" class="btn btn-default btn-xs">{% trans 'Send password SMS' %}</button>
                        </div>
                    </div>
                </div>
                <hr/>
                <input type="submit" class="btn btn-primary btn-xs center-block" value="{% trans 'Change' %}">
                <hr/>
                {% if dv_session %}
                    <div class="row">
                        <div class="col-md-2"></div>
                        <div class="col-md-8 text-center">
                            <table class="table table-striped table-hover table-condensed">
                                <thead class="">
                                    <tr class="border-color">
                                        <th class="text-center">IP</th>
                                        <th class="text-center">Session time</th>
                                        <th class="text-center">Trafic in</th>
                                        <th class="text-center">Trafic out</th>
                                        <th class="text-center">Server</th>
                                        <th class="text-center">Zap</th>
                                        <th class="text-center">Hangup</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for s in dv_session %}
                                        <tr>
                                            <td>
                                                {% ip_convert s.framed_ip_address %}
                                            </td>
                                            <td>
                                                {% convert_timestamp_to_time s.started %}
                                            </td>
                                            <td>
                                                {% convert_bytes s.acct_input_octets s.acct_input_gigawords%}
                                            </td>
                                            <td>
                                                {% convert_bytes s.acct_output_octets s.acct_output_gigawords%}
                                            </td>
                                            <td>
                                                {{ s.nas.name }}
                                            </td>
                                            <td>
                                                <a class="btn btn-xs btn-link" href="#"><span class="glyphicon glyphicon-remove"></span></a>
                                            </td>
                                            <td>
                                                <a class="btn btn-xs btn-link" href="?hangup&{{ s.acct_session_id }}"><span class="glyphicon glyphicon-off"></span></a>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <div class="col-md-2"></div>
                    </div>
                {% endif %}
            </form>
        </div>
    </div>
{% endblock %}
{% block extra_content %}
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12">
            <div class="well well-sm text-center">
                <ul class="list-inline">
                    <li><a title="{% trans 'Statistics' %}" href="{% url 'core:client_statistics' uid %}">{% trans 'Statistics' %}</a></li>
                    <li><a title="{% trans 'Errors' %}" href="{% url 'core:client_errors' uid %}">{% trans 'Errors' %}</a></li>
                    <li><a title="Расписание" href="">Расписание</a></li>
                    <li><a title="Компенсация" href="">Компенсация</a></li>
                </ul>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12">
            <div class="well well-sm">
                {% include 'dv.html' with dv=dv %}
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12">
            <div class="well well-sm">
                <div class="page-header text-center">
                    <h4>{% trans 'User info' %}</h4>
                </div>
                <br/>
                <form class="form-horizontal" method="post" name="user_form">{% csrf_token %}
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group form-group-sm">
                                <label for="inputEmail3" class="col-sm-4 control-label">{% trans 'FIO:' %}</label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" id="firstname" name="firstname" placeholder="Firstname, Lastname" value="{{ user.pi.fio }}">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group form-group-sm">
                                <label for="DISTRICT" class="col-sm-4 control-label">{% trans 'Districts:' %}</label>
                                <div class="col-sm-8">
                                    <select download-on-click='1' name='ADDRESS_DISTRICT' id='DISTRICT' class='form-control'>
                                        <option value="{{ user.pi.city_id }}">{{ user.pi.city }}</option>
                                    </select>
                                </div>
                                <script src="{% static 'js/searchLocation.js' %}"></script>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group form-group-sm">
                                <label for="STREET" class="col-sm-4 control-label">{% trans 'Street:' %}</label>
                                <div class="col-sm-8">
                                    <select download-on-click='1' name='ADDRESS_STREET' id='STREET' class='form-control'>
                                        <option value="{{ user.pi.street_id }}">{{ user.pi.street }}</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group form-group-sm">
                                <label for="inputEmail3" class="col-sm-4 control-label">E-mail:</label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" id="e-mail" name="e-mail" placeholder="E-mail:" value="{{ user.pi.email }}">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group form-group-sm">
                                <label for="BUILD" class="col-sm-4 control-label">{% trans 'Build' %}:</label>
                                <div class="col-sm-8">
                                    <select download-on-click='1' name='ADDRESS_BUILD' id='BUILD' class='form-control'>
                                        <option value="{{ user.pi.location_id }}">{{ user.pi.location }}</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group form-group-sm">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group form-group-sm">
                                <label for="inputEmail3" class="col-sm-4 control-label">{% trans 'Phone:' %}</label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" id="phone" name="phone" placeholder="{% trans 'phone' %}" value="{{ user.pi.phone }}">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                                <div class="form-group form-group-sm">
                                    <label for="inputEmail3" class="col-sm-4 control-label">Flat:</label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control" id="flat" name="flat" placeholder="Flat:" value="{{ user.pi.kv }}">
                                    </div>
                                </div>
                            </div>
                        </div>
                    <hr/>
                    <input type="submit" name="dv_submit" class="btn btn-primary btn-xs center-block" value="{% trans 'Change' %}">
                </form>
            </div>
        </div>
    </div>
{% endblock %}