{% extends 'layout.html' %}
{% load i18n %}
{% load url %}
{% load staticfiles %}
{% block extra_js %}
    <script src="{% static 'djangorpc/js/jquery-1.9.1.min.js' %}"></script>
    <script src="{% static 'djangorpc/js/jquery.util.js' %}"></script>
    <script src="{% static 'djangorpc/js/jquery.rpc.js' %}"></script>
    <script src="{% static 'djangorpc/js/jquery.form.js' %}"></script>
    <script src="{% static 'custom/js/csrf.js' %}"></script>
    <script src="{% static 'custom/js/chosen.jquery.js' %}"></script>
{% endblock %}
{% block extra_css %}
    <link href="{% static 'custom/css/chosen.css' %}" rel="stylesheet" type="text/css">
{% endblock %}
{% block extra_scripts %}
<script type="application/javascript">
$(document).ready(function() {
    console.log($('#id_district').val())
    if ($('#id_district').val()){
        getStreets($('#id_district').val())
    }
    if ($('#id_street').val()){
        getHouses($('#id_street').val())
    }
    if (!$("#id_street").val()){
        $("#id_street option").remove();
        $('#id_street').append($("<option></option>").attr("value", '').text('---------'));
    }
    if (!$('#id_house').val()){
        $("#id_house option").remove();
        $('#id_house').append($("<option></option>").attr("value", '').text('---------'));
    }
    function getStreets(value){
        url = "/api/streets/" + "?district=" + value;
        $.ajax({
            type: "GET",
            url: url,
            datatype: 'json',
            beforeSend: function() {
                $('#response').html("<img src='/static/custom/images/ajax-loader.gif' />");
            },
            success: function(data){
                //var parsed_data = $.parseJSON(data);
{#                $('#id_street').append($("<option></option>").attr("value", '').text('-----------'));#}
                $.each(data, function(index, val) {
                    $('#id_street').append($("<option></option>").attr("value", val.id).text(val.name));
                });
            }
        });
    }
    function getHouses(value){
        url = '/api/houses/' + '?street=' + value;
        $.ajax({
            type: "GET",
            url: url,
            datatype: 'json',
            beforeSend: function() {
                $('#response').html("<img src='/static/custom/images/ajax-loader.gif' />");
            },
            success: function(data){
                //var parsed_data = $.parseJSON(data);
{#                $('#id_house').append($("<option></option>").attr("value", '').text('-----------'));#}
                $.each(data, function(index, val) {
                    $('#id_house').append($("<option></option>").attr("value", val.id).text(val.number));
                });
            }
        });
    }
    $('#id_district').on('change', function(){
        if (this.value){
            $("#id_street option").remove();
            getStreets(this.value);
            $('#id_street').append($("<option></option>").attr("value", '').text('---------'));
        } else {
            $("#id_street option").remove();
            $('#id_street').append($("<option></option>").attr("value", '').text('---------'));
        }
    });
    $('#id_street').on('change', function(){
        if (this.value){
            $("#id_house option").remove();
            getHouses(this.value);
            $('#id_house').append($("<option></option>").attr("value", '').text('---------'));
        } else {
            $("#id_house option").remove();
            $('#id_house').append($("<option></option>").attr("value", '').text('---------'));
        }
    });
    $(document).ajaxSend(function(event, request, settings) {
        $('#overlay').show();
    });

    $(document).ajaxComplete(function(event, request, settings) {
        $('#overlay').hide();
    });
});
</script>
{% endblock %}
{% block breadcrumbs %}
    <ol class="breadcrumb">
      <li class=""><a href="{% url 'core:index' %}">{% trans 'Dashboard' %}</a></li>
      <li class="active">{% trans 'Search' %}</li>
    </ol>
{% endblock %}
{% block content %}
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12">
            <div class="well well-sm">
                <div class="row">
                    <div class="col-lg-12">
                        {% if error %}
                            <div class="alert alert-danger alert-dismissible" role="alert">
                                <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                <p class="text-center">{{ error }}</p>
                            </div>
                        {% endif %}
                        <div class="page-header text-center">
                            <h4><i class="fa fa-search"></i> {% trans 'Search' %}</h4>
                        </div>
                        <br/>
                        <div class="col-md-3"></div>
                        <div class="col-md-6">
                            <form method="GET" class="text-center">
                                <ul class="nav nav-pills nav-justified">
                                    <li role="presentation" class="active"><a href="#">{% trans 'Clients' %}</a></li>
                                    <li role="presentation"><a href="#">{% trans 'Company' %}</a></li>
                                    <li role="presentation"><a href="#">{% trans 'Fees' %}</a></li>
                                    <li role="presentation"><a href="#">{% trans 'Payments' %}</a></li>
                                </ul>
                                <hr>
                                <div class="form-group col-lg-6">
                                    <label>{% trans 'Login' %}</label>
                                    <input type="text" name="login" class="form-control input-sm" id="">
                                </div>

                                <div class="form-group col-lg-6">
                                    <label>{% trans 'UID' %}</label>
                                    <input type="text" name="uid" class="form-control input-sm" id="" value="">
                                </div>

                                <div class="form-group col-lg-6">
                                    <label>Password</label>
                                    <input type="password" name="" class="form-control input-sm" id="" value="">
                                </div>

                                <div class="form-group col-lg-6">
                                    <label>Repeat Password</label>
                                    <input type="password" name="" class="form-control input-sm" id="" value="">
                                </div>

                                <div class="form-group col-lg-6">
                                    <label>Email Address</label>
                                    <input type="" name="" class="form-control input-sm" id="" value="">
                                </div>

                                <div class="form-group col-lg-6">
                                    <label>Repeat Email Address</label>
                                    <input type="" name="" class="form-control input-sm" id="" value="">
                                </div>
                                {% if error %}
                                    <div class="alert alert-danger alert-dismissible" role="alert">
                                        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                        <p class="text-center">{{ error }}</p>
                                    </div>
                                {% endif %}
                                <br/>
                                <div class="col-md-3"></div>
                                <br/>
                                <div class="form-group col-md-6">
                                    {{ search_form.as_p }}
                                    <button type="submit" class="btn btn-default">Submit</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-md-3"></div>
            </div>
        </div>
    </div>
    <div class="row">
        <ul class="col-lg-12">
            {% if login %}
                {% if error %}
                {% else %}
                    <div class="pag-nav">
                        <nav class="center-block">
                            <ul class="pagination pagination-sm">
                                {% if users.has_previous %}
                                    <li>
                                        <a href="?{% url_replace_page request 'page' '1' %}" aria-label="Previous">
                                            <span aria-hidden="true">1</span>
                                        </a>
                                    </li>
                                    {% if users.number > 2 %}
                                        <li class="disabled">
                                            <a href="#" aria-label="Previous">
                                                <span aria-hidden="true">...</span>
                                            </a>
                                        </li>
                                    {% endif %}
                                {% endif %}
                                {% for p in page_list %}
                                    {% if users.number == p %}
                                        <li class="active">
                                            <a href="?{% url_replace_page request 'page' p %}">{{ p }}</a>
                                        </li>
                                    {% else %}
                                        <li class="">
                                            <a href="?{% url_replace_page request 'page' p %}">{{ p }}</a>
                                        </li>
                                    {% endif %}
                                {% endfor %}
                                {% if users.has_next %}
                                    <li class="disabled">
                                        <a href="#" aria-label="Previous">
                                            <span aria-hidden="true">...</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="?{% url_replace_page request 'page' users.paginator.num_pages %}" aria-label="Next">
                                            <span aria-hidden="true">{{ users.paginator.num_pages }}</span>
                                        </a>
                                    </li>
                                {% else %}
                                    <li class="disabled">
                                        <a href="#" aria-label="Next">
                                            <span aria-hidden="true">&raquo;</span>
                                        </a>
                                    </li>
                                {% endif %}
                            </ul>
                        </nav>
                    </div>
                    <table class="ui black table table-hover table-striped table-condensed">
                        <thead>
                            <tr>
                                <th>{% trans 'Login' %}</th>
                                <th>{% trans 'FIO' %}</th>
                                <th>{% trans 'City' %}</th>
                                <th>{% trans 'Street' %}</th>
                                <th>{% trans 'Build' %}</th>
                                <th>{% trans 'Flat' %}</th>
                                <th>{% trans 'Deposit' %}</th>
                                <th>{% trans 'Credit' %}</th>
                                <th>{% trans 'Login status' %}</th>
                                <th>{% trans 'Deleted' %}</th>
                                <th>{% trans '-' %}</th>
                                <th>{% trans '-' %}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for user in user_list %}
                            <tr>
                                <td><a href="{% url 'core:index' %}?index=clients&uid={{ user.id }}">{{ user.login }}</a></td>
                                <td>{{ user.user_pi.fio }}</td>
                                <td>{{ user.pi.city }}</td>
                                <td>{{ user.pi.street }}</td>
                                <td>{{ user.pi.location }}</td>
                                <td>{{ user.pi.kv }}</td>
                                {% if user.bill.deposit < 0 %}
                                    <td><span style="color: red">{{ user.bill.deposit }}</span></td>
                                {% else %}
                                    <td>{{ user.bill.deposit }}</td>
                                {% endif %}
                                {% if user.credit > 0 %}
                                    <td><span style="color: green">{{ user.credit }}</span></td>
                                {% else %}
                                    <td>{{ user.credit }}</td>
                                {% endif %}
                                {% if user.disabled %}
                                    <td><span style="color: red">{% trans 'Disabled' %}</span></td>
                                {% else %}
                                    <td><span style="color: green">{% trans 'Active' %}</span></td>
                                {% endif %}
                                {% if user.deleted %}
                                    <td><span style="color: red">{% trans 'Yes' %}</span></td>
                                {% else %}
                                    <td>{% trans 'No' %}</td>
                                {% endif %}
                                <td><a href="{% url 'core:index' %}?index=payments&uid={{ user.id }}"><img src="{% static 'custom/images/button_payments.png' %}" /></a></td>
                                <td><a href="{% url 'core:fees' %}?uid={{ user.id }}"><img src="{% static 'custom/images/button_fees.png' %}" /></a></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    <div class="pag-nav">
                        <nav class="center-block">
                            <ul class="pagination pagination-sm">
                                {% if users.has_previous %}
                                    <li>
                                        <a href="?{% url_replace_page request 'page' '1' %}" aria-label="Previous">
                                            <span aria-hidden="true">1</span>
                                        </a>
                                    </li>
                                    {% if users.number > 2 %}
                                        <li class="disabled">
                                            <a href="#" aria-label="Previous">
                                                <span aria-hidden="true">...</span>
                                            </a>
                                        </li>
                                    {% endif %}
                                {% endif %}
                                {% for p in page_list %}
                                    {% if users.number == p %}
                                        <li class="active">
                                            <a href="?{% url_replace_page request 'page' p %}">{{ p }}</a>
                                        </li>
                                    {% else %}
                                        <li class="">
                                            <a href="?{% url_replace_page request 'page' p %}">{{ p }}</a>
                                        </li>
                                    {% endif %}
                                {% endfor %}
                                {% if users.has_next %}
                                    <li class="disabled">
                                        <a href="#" aria-label="Previous">
                                            <span aria-hidden="true">...</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="?{% url_replace_page request 'page' users.paginator.num_pages %}" aria-label="Next">
                                            <span aria-hidden="true">{{ users.paginator.num_pages }}</span>
                                        </a>
                                    </li>
                                {% else %}
                                    <li class="disabled">
                                        <a href="#" aria-label="Next">
                                            <span aria-hidden="true">&raquo;</span>
                                        </a>
                                    </li>
                                {% endif %}
                            </ul>
                        </nav>
                    </div>
                    <ul class="list-group">
                        <li class="list-group-item">
                            <span class="badge">{{ all }}</span>
                            {% trans 'All' %}
                        </li>
                        <li class="list-group-item">
                            <span class="badge">{{ end }}</span>
                            {% trans 'End' %}
                        </li>
                        <li class="list-group-item">
                            <span class="badge">{{ disabled }}</span>
                            {% trans 'Disabled' %}
                        </li>
                        <li class="list-group-item">
                            <span class="badge">{{ deleted }}</span>
                            {% trans 'Deleted' %}
                        </li>
                    </ul>
                {% endif %}
            {% endif %}
            {% if district %}
                {% if error %}
                {% else %}
                    <ul class="list-group">
                        <li class="list-group-item">
                            <ul class="pagination pagination-sm">
                                {% if users.has_previous %}
                                    <li>
                                        <a href="?{% url_replace_page request 'page' '1' %}" aria-label="Previous">
                                            <span aria-hidden="true">1</span>
                                        </a>
                                    </li>
                                    {% if users.number > 2 %}
                                        <li class="disabled">
                                            <a href="#" aria-label="Previous">
                                                <span aria-hidden="true">...</span>
                                            </a>
                                        </li>
                                    {% endif %}
                                {% endif %}
                                {% for p in page_list %}
                                    {% if users.number == p %}
                                        <li class="active">
                                            <a href="?{% url_replace_page request 'page' p %}">{{ p }}</a>
                                        </li>
                                    {% else %}
                                        <li class="">
                                            <a href="?{% url_replace_page request 'page' p %}">{{ p }}</a>
                                        </li>
                                    {% endif %}
                                {% endfor %}
                                {% if users.has_next %}
                                    <li class="disabled">
                                        <a href="#" aria-label="Previous">
                                            <span aria-hidden="true">...</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="?{% url_replace_page request 'page' users.paginator.num_pages %}" aria-label="Next">
                                            <span aria-hidden="true">{{ users.paginator.num_pages }}</span>
                                        </a>
                                    </li>
                                {% else %}
                                    <li class="disabled">
                                        <a href="#" aria-label="Next">
                                            <span aria-hidden="true">&raquo;</span>
                                        </a>
                                    </li>
                                {% endif %}
                            </ul>
                        </li>
                    </ul>
                    <table class="ui black table table-hover table-striped table-condensed">
                        <thead>
                            <tr>
                                <th>{% trans 'Login' %}</th>
                                <th>{% trans 'FIO' %}</th>
                                <th>{% trans 'City' %}</th>
                                <th><a href="?{% url_replace request 'order_by' 'street' %}">{% trans 'Street' %}</a><i class="sortable"></i></th>
                                <th>{% trans 'Build' %}</th>
                                <th>{% trans 'Flat' %}</th>
                                <th>{% trans 'Deposit' %}</th>
                                <th>{% trans 'Credit' %}</th>
                                <th>{% trans 'Login status' %}</th>
                                <th>{% trans 'Deleted' %}</th>
                                <th>{% trans '-' %}</th>
                                <th>{% trans '-' %}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for u in users %}
                            <tr>
                                <td><a href="{% url 'core:clients' %}{{ u.user_id }}">{{ u.user_id__login }}</a></td>
                                <td>{{ u.fio }}</td>
                                <td>{{ city }}</td>
                                <td>{{ u.street__name }}</td>
                                <td>{{ u.location__number }}</td>
                                <td>{{ u.kv }}</td>
                                {% if u.user_id__credit > u.user_id__bill__deposit and u.user_id__credit > 0 and u.user_id__bill__deposit != 0%}
                                    <td><span style="color: orange">{{ u.user_id__bill__deposit }}</span></td>
                                {% else %}
                                    {% if u.user_id__bill__deposit < 0 %}
                                    <td><span style="color: red">{{ u.user_id__bill__deposit }}</span></td>
                                {% else %}
                                    <td>{{ u.user_id__bill__deposit }}</td>
                                {% endif %}
                                {% endif %}
                                {% if u.user_id__credit > 0 %}
                                    <td><span style="color: green">{{ u.user_id__credit }}</span></td>
                                {% else %}
                                    <td>{{ u.user_id__credit }}</td>
                                {% endif %}
                                {% if u.user_id__disabled %}
                                    <td><span style="color: red">{% trans 'Disabled' %}</span></td>
                                {% else %}
                                    <td><span style="color: green">{% trans 'Active' %}</span></td>
                                {% endif %}
                                {% if u.user_id__deleted %}
                                    <td><span style="color: red">{% trans 'Yes' %}</span></td>
                                {% else %}
                                    <td>{% trans 'No' %}</td>
                                {% endif %}
                                <td><a href="{% url 'core:client_payments' u.user_id %}"><img src="{% static 'custom/images/button_payments.png' %}" /></a></td>
                                <td><a href="{% url 'core:client_fees' u.user_id %}"><img src="{% static 'custom/images/button_fees.png' %}" /></a></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    <ul class="list-group">
                        <li class="list-group-item">
                            <ul class="pagination pagination-sm">
                                {% if users.has_previous %}
                                    <li>
                                        <a href="?{% url_replace_page request 'page' '1' %}" aria-label="Previous">
                                            <span aria-hidden="true">1</span>
                                        </a>
                                    </li>
                                    {% if users.number > 2 %}
                                        <li class="disabled">
                                            <a href="#" aria-label="Previous">
                                                <span aria-hidden="true">...</span>
                                            </a>
                                        </li>
                                    {% endif %}
                                {% endif %}
                                {% for p in page_list %}
                                    {% if users.number == p %}
                                        <li class="active">
                                            <a href="?{% url_replace_page request 'page' p %}">{{ p }}</a>
                                        </li>
                                    {% else %}
                                        <li class="">
                                            <a href="?{% url_replace_page request 'page' p %}">{{ p }}</a>
                                        </li>
                                    {% endif %}
                                {% endfor %}
                                {% if users.has_next %}
                                    <li class="disabled">
                                        <a href="#" aria-label="Previous">
                                            <span aria-hidden="true">...</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="?{% url_replace_page request 'page' users.paginator.num_pages %}" aria-label="Next">
                                            <span aria-hidden="true">{{ users.paginator.num_pages }}</span>
                                        </a>
                                    </li>
                                {% else %}
                                    <li class="disabled">
                                        <a href="#" aria-label="Next">
                                            <span aria-hidden="true">&raquo;</span>
                                        </a>
                                    </li>
                                {% endif %}
                            </ul>
                        </li>
                    </ul>
                    <ul class="list-group">
                        <li class="list-group-item list-group-item-botton">
                            <span class="badge">{{ all }}</span>
                            {% trans 'All' %}
                        </li>
                        <li class="list-group-item list-group-item-botton">
                            <span class="badge">{{ end }}</span>
                            {% trans 'End' %}
                        </li>
                        <li class="list-group-item list-group-item-botton">
                            <span class="badge">{{ disabled }}</span>
                            {% trans 'Disabled' %}
                        </li>
                        <li class="list-group-item list-group-item-botton">
                            <span class="badge">{{ deleted }}</span>
                            {% trans 'Deleted' %}
                        </li>
                    </ul>
                {% endif %}
            {% endif %}
        </ul>
    </div>
{% endblock %}