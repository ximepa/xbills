{% extends 'base.html' %}
{% load i18n %}
{% load url %}
{% load staticfiles %}

{% block layout %}
    <div class="row">
        <div class="column">
            <div class="ui stackable top attached mini tabular menu">
                <div class="{% active request 'core:client' client.id %} item"><a href="{% url 'core:client' client.id %}"><i class="fa fa-info" aria-hidden="true"></i> {% trans 'Base' %}</a></div>
                <div class="{% active request 'core:client_payments' client.id %} item"><a href="{% url 'core:client_payments' client.id %}">{% trans 'Payments' %}</a></div>
                <div class="{% active request 'core:client_fees' client.id %} item"><a href="{% url 'core:client_fees' client.id %}">{% trans 'Fees' %}</a></div>
                {% check_module 'olltv' as check_module_olltv %}
                {% if check_module_olltv %}
                        <div class="{% active request 'core:user_olltv' client.id %} item"><a href="{% url 'core:user_olltv' client.id %}"><i class="fa fa-television" aria-hidden="true"></i> {% trans 'OLLTV' %}</a></div>
                {% endif %}
                {% check_module 'ipdhcp' as check_module_dhcp %}
                {% if check_module_dhcp %}
                        <div class="{% active request 'core:user_dhcp' client.id %} item"><a href="{% url 'core:user_dhcp' client.id %}"><i class="fa fa-television" aria-hidden="true"></i> {% trans 'Dhcp' %}</a></div>
                {% endif %}
                {% check_module 'claims' as check_module_claims %}
                {% if check_module_claims %}
                        <div class="{% active request 'core:user_claims' client.id %} item"><a href="{% url 'core:user_claims' client.id %}"><i class="fa fa-wpforms fa-fw" aria-hidden="true"></i>{% trans 'Claims' %}</a></div>
                {% endif %}
            </div>
            <div class="ui bottom attached active tab segment">
                <div class="ui stackable mini menu">
                    <a class="item" id="session">
                        {% if dv_session %}
                            <div class="floating ui mini green label">
                                {{ dv_session.count }}
                            </div>
                        {% endif %}
                        <i class="idea icon"></i>
                        {% trans 'Sessions' %}
                    </a>
                    <div id="browse" class="ui very wide mini popup bottom left transition hidden">
                        <div class="ui column stacked grid">
                            <div class="ui segment">
                                {% if dv_session %}
                                    <table class="ui blue small selectable striped table">
                                        <thead class="">
                                            <tr>
                                                <th>IP</th>
                                                <th>{% trans 'Time' %}</th>
                                                <th>In</th>
                                                <th>Out</th>
                                                <th>{% trans 'Server' %}</th>
                                                <th>{% trans 'Zap' %}</th>
                                                <th>{% trans 'Hangup' %}</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for s in dv_session %}
                                                <tr>
                                                    <td>
                                                        {% ip_convert s.framed_ip_address %}
                                                    </td>
                                                    <td>
                                                        {% convert_timestamp_to_time s.started %}
                                                    </td>
                                                    <td>
                                                        {% convert_bytes s.acct_input_octets s.acct_input_gigawords%}
                                                    </td>
                                                    <td>
                                                        {% convert_bytes s.acct_output_octets s.acct_output_gigawords%}
                                                    </td>
                                                    <td>
                                                        {{ s.nas.name }}
                                                    </td>
                                                    <td>
                                                        <a class="btn btn-xs btn-link" href="#">
                                                            <span class="fa fa-times fa-fw"></span>
                                                        </a>
                                                    </td>
                                                    <td>
                                                        <a class="btn btn-xs btn-link" href="?hangup&acct_session_id={{ s.acct_session_id }}&nas_id={{ s.nas_id }}&port_id={{ s.nas_port_id }}&user_name={{ s.user_name }}"><span class="fa fa-power-off fa-fw"></span></a>
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                {% else %}
                                    {% trans 'No Sessions' %}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ui stackable grid">
	                <div class="row">
                        <div class="three wide column">
                            <div class="ui secondary segment">
                                <div class="ui form">
                                    <div class="field">
                                        <a class="ui grey ribbon label">{% trans 'General Information' %}</a>
                                        <div class="ui middle aligned divided list">
                                            <div class="item">
                                                <div class="content">
                                                    <i class="user icon"></i>{% trans 'FIO' %} :
                                                    <span style="font-weight: bold">{{ client.user_pi.fio }}</span>
                                                </div>
                                            </div>
                                            <div class="item">
                                                <div class="content">
                                                    <i class="money icon"></i>{% trans 'Deposit' %} :
                                                    {% if client.credit > client.bill.deposit and client.credit > 0 %}
                                                        <a class="ui grey label" >{{ client.bill.deposit|floatformat:2 }}</a>
                                                    {% elif client.bill.deposit > 50 %}
                                                        <a class="ui green label">{{ client.bill.deposit|floatformat:2 }}</a>
                                                    {% elif client.bill.deposit < 50 and client.bill.deposit > 20 %}
                                                        <a class="ui label blue label">{{ client.bill.deposit|floatformat:2 }}</a>
                                                    {% elif client.bill.deposit < 20 and client.bill.deposit > 2.50 %}
                                                        <a class="ui label orange label">{{ client.bill.deposit|floatformat:2 }}</a>
                                                    {% else %}
                                                        <a class="ui label red label">{{ client.bill.deposit|floatformat:2 }}</a>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="item">
                                                <div class="content">
                                                    <i class="credit card alternative icon"></i>{% trans 'Credit' %} :
                                                    {% if client.credit > 0 %}
                                                        <a class="ui green label" >{{ client.credit|floatformat:2 }}</a>
                                                    {% else %}
                                                        <a class="ui label">{{ client.credit|floatformat:2 }}</a>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="item">
                                                <div class="content">
                                                    <i class="users icon"></i>{% trans 'Bill ID' %} :
                                                    {% if client.bill.id %}
                                                        <a class="ui blue label" >{{ client.bill.id }}</a>
                                                    {% else %}
                                                        <a class="ui blue label" >{{ client.company.bill_id }}</a>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            {% if client.company %}
                                            <div class="item">
                                                <div class="content">
                                                    <i class="users icon"></i>{% trans 'Company' %} :
                                                    <a class="ui blue label">{{ client.company.name }}</a>
                                                </div>
                                            </div>
                                            {% endif %}
                                            <div class="item">
                                                <div class="content">
                                                    <i class="users icon"></i>{% trans 'Group' %} :
                                                    <a class="ui blue label" >{{ client.gid }}</a>
                                                </div>
                                            </div>
                                            <div class="item">
                                                <i class="marker icon"></i>
                                                <div class="content">
                                                    {{ client.user_pi.city }}
                                                    {% if client.user_pi.street %}
                                                        , {{ client.user_pi.street.name }}
                                                        {% if client.user_pi.location %}
                                                            {{ client.user_pi.location }}
                                                        {% endif %}
                                                        {% if client.user_pi.kv %}
                                                            {% trans 'Flat' %} {{ client.user_pi.kv }}
                                                        {% endif %}
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="item">
                                                <i class="mail icon"></i>
                                                <div class="content">
                                                    <a href="mailto:{{ client.user_pi.email }}">{{ client.user_pi.email }}</a>
                                                </div>
                                            </div>
                                            <div class="item">
                                                <div class="content">
                                                    <i class="registered icon"></i>{% trans 'Registration' %} :
                                                    <label>{{ client.registration }}</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="field">
                                        <a class="ui blue ribbon label" onclick="servicesToggle()">Community</a>
                                        <div class="ui middle aligned divided list" id="services" style="display: none">
                                            <div class="item">
                                                <div class="content">
                                                    <i class="users icon"></i>{% trans 'FIO' %} :
                                                    <span style="font-weight: bold">{{ client.user_pi.fio }}</span>
                                                </div>
                                            </div>
                                            <div class="item">
                                                <div class="content">
                                                    <i class="users icon"></i>{% trans 'Deposit' %} :
                                                    {% if client.credit > client.bill.deposit and client.credit > 0 %}
                                                        <a class="ui grey label" >{{ client.bill.deposit|floatformat:2 }}</a>
                                                    {% elif client.bill.deposit > 50 %}
                                                        <a class="ui green label">{{ client.bill.deposit|floatformat:2 }}</a>
                                                    {% elif client.bill.deposit < 50 and client.bill.deposit > 20 %}
                                                        <a class="ui label blue label">{{ client.bill.deposit|floatformat:2 }}</a>
                                                    {% elif client.bill.deposit < 20 and client.bill.deposit > 2.50 %}
                                                        <a class="ui label orange label">{{ client.bill.deposit|floatformat:2 }}</a>
                                                    {% else %}
                                                        <a class="ui label red label">{{ client.bill.deposit|floatformat:2 }}</a>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="item">
                                                <div class="content">
                                                    <i class="users icon"></i>{% trans 'Credit' %} :
                                                    {% if client.credit > 0 %}
                                                        <a class="ui green label" >{{ client.credit|floatformat:2 }}</a>
                                                    {% else %}
                                                        <a class="ui label">{{ client.credit|floatformat:2 }}</a>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="item">
                                                <div class="content">
                                                    <i class="users icon"></i>{% trans 'Bill ID' %} :
                                                    {% if client.bill.id %}
                                                        <a class="ui blue label" >{{ client.bill.id }}</a>
                                                    {% else %}
                                                        <a class="ui blue label" >{{ client.company.bill_id }}</a>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            {% if client.company %}
                                            <div class="item">
                                                <div class="content">
                                                    <i class="users icon"></i>{% trans 'Company' %} :
                                                    <a class="ui blue label">{{ client.company.name }}</a>
                                                </div>
                                            </div>
                                            {% endif %}
                                            <div class="item">
                                                <div class="content">
                                                    <i class="users icon"></i>{% trans 'Group' %} :
                                                    <a class="ui blue label" >{{ client.gid }}</a>
                                                </div>
                                            </div>
                                            <div class="item">
                                                <i class="marker icon"></i>
                                                <div class="content">
                                                    {{ client.user_pi.city }}
                                                    {% if client.user_pi.street %}
                                                        , {{ client.user_pi.street.name }}
                                                        {% if client.user_pi.location %}
                                                            {{ client.user_pi.location }}
                                                        {% endif %}
                                                        {% if client.user_pi.kv %}
                                                            {% trans 'flat' %} {{ client.user_pi.kv }}
                                                        {% endif %}
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="item">
                                                <i class="mail icon"></i>
                                                <div class="content">
                                                    <a href="mailto:{{ client.user_pi.email }}">{{ client.user_pi.email }}</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="thirteen wide column">
                            <div class="ui secondary segment">
                                {% block content %}
                                {% endblock %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="ui stackable grid">
        {% block extra_content %}
        {% endblock %}
    </div>
{% endblock %}
